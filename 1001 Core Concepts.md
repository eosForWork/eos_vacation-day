# 1001 Core Concepts (2/2)

1. Scaling(擴展性)
2. Consistency(一致性)
3. Locking(鎖定性)
4. Indexing(索引性)
5. **Communication Protocols(通訊協定)**
6. **Security(安全性)**
7. **Monitoring(監控)**

## **Communication Protocols通訊協定**

一般分為內部通訊協定與外部通訊協定：

1. **內部通訊協定**：同一系統或網絡內部的設備之間進行數據交換的規則和標準，通常使用HTTPs或gRPC來處理，gRPC基於HTTP/2，使用二進制格式（Protocol Buffers），在性能上通常優於傳統的RESTful API，特別是在需要雙向流和高吞吐量的場景中。
2. **外部通訊協定**：客戶端（如瀏覽器或移動應用）與系統之間的通信，通常涉及不同網絡或地理位置的設備，須考量誰發起通信、延遲問題以及數據量等因素。

| **特徵** | **內部通信協定** | **外部通信協定** |
| --- | --- | --- |
| **範圍** | 同一系統或網絡內部 | 跨越不同系統或網絡 |
| **常用協定** | HTTP(S)、gRPC | HTTP(S)、SSE、Long Polling(長輪詢)、Websockets |
| **性能考量** | 主要關注低延遲和高吞吐量 | 考慮延遲、數據量及客戶端需求 |
| **設計簡單性** | 通常較簡單 | 可能需要更複雜的設計 |

### **REST、SSE、WebSockets 比較：**

| **技術** | **難易度** | **常用程度** | **通信方向** | **適用場景** | **特點** |
| --- | --- | --- | --- | --- | --- |
| **HTTP(S)** | 低 | 高 | 單向 (客戶端to伺服器） | 基本的數據請求和靜態內容加載 | - 簡單易用，廣泛支持- 無狀態設計，便於水平擴展 |
| **長輪詢 (Long Polling)** | 中 | 中 | 單向 (客戶端to伺服器） | 需要即時更新但無法使用Websockets的場景，如**聊天應用、監控系統的狀態更新** | - 能keep客戶端與伺服器的連接- 減少不必要的請求 |
| **Websockets** | **高** | 中 | **雙向**(客戶端＆伺服器） | 需要實時雙向通信的應用，如**在線遊戲、即時聊天、股票報價、即時通知系統** | - 支持低延遲雙向通信- 持久連接，適合高頻率數據交換 |
| **伺服器推送事件 (SSE)** | 中 | 中 | 單向 (**伺服器**to**客戶端**） | 需要從伺服器主動推送數據到客戶端的場景，如**新聞推送**或**社交媒體更新** | - 伺服器主動推送數據給客戶端- 使用單一長連接，適合頻繁更新 |

> **狀態性**（Statefulness）指的是系統在處理請求時需要記住某些信息或上下文，例如用戶會話或交易狀態。這種狀態的管理會增加系統的複雜性，因為它需要考慮如何存儲、更新和同步這些狀態信息，將狀態轉移到**消息代理**或**數據庫**中，可以減少服務本身的狀態依賴，從而簡化系統設計。
> 

## **Security(安全性)**

在系統設計面試中，安全性是評估能力的一個重要指標。應徵者需要展示他們對安全最佳實踐的理解，以及如何將這些實踐應用於設計中，以確保**系統的完整性、可用性和機密性**。這不僅有助於建立可靠的系統，也能增強用戶對系統的信任。

**常見的安全問題**

- **身份驗證 / 授權**：
    - 在許多系統中，會對外部用戶暴露API，因此需要確保只有特定用戶能夠訪問這些API。使用API閘道（API Gateway）或專門的身份驗證服務（如Auth0）可以有效管理身份驗證和授權，避免重複造輪子。
    - 面試時可能需要討論具體實體的安全措施，但通常只需提到「我的API閘道將處理身份驗證和授權」即可。
- **加密**：
    - 當處理敏感數據時，需要確保數據不被未經授權的人查看。這包括對傳輸中的數據（如使用HTTPS進行協議加密）和靜態數據（如使用存儲加密）進行保護。
    - HTTPS是用於加密網絡流量的標準SSL/TLS協議。如果使用gRPC，它也支持SSL/TLS。
    - 對於靜態數據，應使用支持加密的數據庫或在存儲之前自行加密數據。
- **數據保護**：
    - 數據保護是確保數據不被未經授權訪問、使用或披露的過程。在生產系統中，經常會關注敏感數據的暴露問題，即使這些數據可能不在授權路徑中。
    - 許多此類暴露是通過抓取端點發現的，因此實施速率限制或請求節流是一個好主意，以防止惡意攻擊。

## **Monitoring(監控機制)**

面試之中遇到監控相關問題主要可以看出受試者在實際情況中如何規劃系統的擴充或是問題處理，監控分為三個級別：**Infrastructure Monitoring(基礎設施監控)、Service-Level Monitoring（服務級監控）、Application-Level Monitoring(應用程式監控)**

| **監控層級** | **描述** | **監控指標範例** | **常用工具** | **補充說明** |
| --- | --- | --- | --- | --- |
| **基礎設施監控** | 監控基礎設施的健康和性能，包括伺服器和網路設備的資源使用情況。 | **- CPU使用率- 記憶體使用率- 磁碟使用率- 網路延遲** | Datadog、New Relic | 此層級有助於及早發現潛在問題，避免系統崩潰。磁碟使用率過高通常是存儲問題的先兆。 |
| **服務級監控** | 監控服務的健康和性能，確保服務能夠快速響應用戶請求。 | **- 請求延遲- 錯誤率- 吞吐量** | Prometheus、Grafana | 此層級提供用戶體驗的直接反映，若請求延遲增加，可能需要優化後端邏輯或增加資源。 |
| **應用程監控** | 監控應用程式的健康和性能，包括用戶行為和業務指標。 | **- 用戶數- 活躍session數- 活躍連線數** | Google Analytics、Mixpanel | 此層級提供業務洞察，幫助產品團隊做出基於數據的決策，以提升用戶滿意度和業務績效。 |
